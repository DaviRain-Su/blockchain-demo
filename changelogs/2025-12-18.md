# 变更日志 (Changelog)

## [2025-12-18] - 初始状态审查与计划

### 已有功能
- 基础区块结构与 SHA-256 哈希。
- 工作量证明 (PoW) 挖矿逻辑。
- 基础 TCP P2P 网络通信。
- 简单的二进制消息序列化。

### 本次任务目标
- [x] 增强网络协议健壮性：引入消息帧机制（长度前缀）。
- [x] 解决 1024 字节缓冲区限制导致的潜在截断问题。
- [x] 统一管理变更文档，记录系统演进过程。

## [2025-12-18] - 网络协议优化：引入消息帧

### 修改点
#### 1. 协议增强 (network.zig)
- **引入长度前缀 (Length Prefixing)**: 在所有消息发送前，先发送一个 4 字节的 `u32` (小端序) 表示消息体长度。
- **重构接收逻辑**: `handleConnection` 不再使用固定 1024 字节缓冲区，而是先读取长度，再动态分配内存读取完整消息体。
- **安全限制**: 增加了 10MB 的单条消息大小限制，防止因异常数据导致内存耗尽。

#### 2. 内存与稳定性
- **精细化内存管理**: 修正了反序列化过程中产生的临时内存泄漏。
- **数据一致性**: 在将接收到的区块存入链时，实现了深拷贝 (`dupe`)，确保区块链数据的独立性。
- **健壮性**: 使用 `readNoEof` 确保在读取消息时不会因为分包导致逻辑错误。

### 影响
- 解决了无法传输大数据区块的问题。
- 提高了网络层的安全性。
